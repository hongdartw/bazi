# 干支學八字計算程式

## 專案概觀

本專案是一個純客戶端運行的 Web 應用程式。使用者可以透過輸入西曆或農曆的出生年月日時，來計算對應的八字（四柱）、大運，並獲得相關的命理分析。

本專案的核心在於其獨特的計算邏輯，特別是「非傳統的年柱提早更換」規則，以及複雜的月柱查表計算，這些都被精確地實現在 JavaScript 中。

## 主要功能

*   **西曆/農曆日期轉換**: 支援西曆與農曆（包含閏月）的輸入切換。
*   **四柱計算**: 根據輸入的日期和時間，精確計算年、月、日、時四柱的干支。
*   **大運計算**: 根據特殊的四柱排序邏輯，計算出人生四個階段的大運起始年份。
*   **干支計數**: 統計四柱中各五行干支的數量，並以圖表化方式呈現。
*   **天性五行解說**: 提供每一柱干支的詳細解讀，包含天性、境遇、造化和相剋關係。
*   **完全客戶端運行**: 無需後端伺服器，所有計算均在瀏覽器中完成，可輕鬆部署於 GitHub Pages 等靜態網站平台。

## 如何使用

1.  在瀏覽器中開啟 `index.html` 檔案。
2.  **輸入出生資訊**:
    *   輸入您的出生西元年、月、日、時。
    *   **選擇日曆類型**: 根據您輸入的日期，選擇「西曆」或「農曆」。
    *   若選擇「農曆」且為閏月，請勾選「閏月」選項。
3.  **計算**: 點擊「干支計算」按鈕。
4.  **查看結果**:
    *   **四柱**: 頁面將顯示您的年、月、日、時四柱及其對應的詩詞斷語。
    *   **大運**: 表格將列出四個大運的干支、起始公元年份，以及對應的歲數。
    *   **干支數計算**: 查看各五行屬性的干支數量統計。
    *   **天性五行生剋**: 點擊「年柱」、「月柱」、「日柱」、「時柱」頁籤，可分別查看該柱的詳細解說。

## 核心模組說明

### 1. 四柱計算 (Bazi Calculation)

四柱的計算是本專案的基礎，其邏輯遵循一套特殊的規則。

*   **年柱 (Year Pillar)**:
    *   **非傳統換年規則**: 與傳統八字以「立春」為年柱轉換點不同，本系統採用一個特殊的「提早換年」機制。當年底接近特定日期時（約在12月初），年柱會提早換成下一年的干支。
    *   **判斷邏輯**: `script.js` 中的 `calculateYearPillar` 函數會根據當前日期是否超過 `sanHeData` 中定義的年度終結時間點，來決定是否需要將年份加一來計算年柱。

*   **月柱 (Month Pillar)**:
    *   月柱的計算極為複雜，它不依賴傳統的節氣，而是與「最終年柱」的地支所屬的「三合」組（申子辰、巳酉丑、寅午戌、亥卯未）相關。
    *   **計算流程**:
        1.  確定最終年柱的「三合」組。
        2.  根據輸入的日期，在該三合組對應的時間範圍表 (`sanHeData`) 中查找，以確定「月支」。
        3.  根據最終年柱的「天干」所屬的「五合」組，以及剛算出的「月支」，在 `wuHeData` 表中查出完整的「月柱」。

*   **日柱 (Day Pillar)**:
    *   日柱的計算採用數學公式，而非查表。`calculateDayPillar` 函數以一個已知的干支參考日（如 2024-01-01 為甲子日）為基準，計算輸入日期與基準日相差的天數，再透過取餘數的方式推算出日柱的干支。

*   **時柱 (Hour Pillar)**:
    *   時支根據一天24小時的固定劃分得出。
    *   時干則由「日柱天干」的「五合」組與「時支」共同決定，規則與月干的計算類似。

### 2. 大運計算 (Grand Canal)

大運的計算邏輯也相當獨特，它並非採用傳統的順行、逆行排運法，而是將**命盤中的四柱本身視為連續的四個大運**。

*   **計算邏輯**:
    1.  `calculateDaYun` 函數首先會查找四柱干支在「六十甲子」中的順序號 (`ganzhiOrder`)。
    2.  找出這四個順序號中的最小值。
    3.  每一柱的「大運起始年份」 = `出生年份 + (該柱的順序號 - 最小順序號)`。
    4.  最後將四個大運依起始年份排序後顯示。

### 3. 干支數計算 (Gan-Zhi Count)

此模組 (`calculateGanzhiCounts`) 用於統計四柱（共八個字）中，屬於不同五行分類的干支數量。例如「甲」和「寅」都計入「甲寅(膽)--脫離」這一類。這提供了一個快速檢視命盤五行分佈的方式，也可得知該人在五行中所欠缺或多餘的干支。

### 4. 天性五行生剋 (Tian-Xing Wu-Xing)

此模組將計算出的每一柱干支，到 `tianxingData` 資料庫中進行匹配，並顯示其詳細的註解，包含：
*   **天性**: 描述該干支組合的個性特質。
*   **境遇**: 描述可能面臨的人生境遇。
*   **造化**: 提供趨吉避凶的建議。
*   **相尅**: 列出與該干支組合相沖克的其他干支。

## 檔案結構

*   `index.html`: 應用程式的主要 HTML 結構。
*   `style.css`: CSS 樣式表，負責應用的視覺呈現。
*   `script.js`: 核心 JavaScript 檔案，包含所有計算邏輯、數據以及 DOM 操作。
*   `README.md`: 本說明檔案。
